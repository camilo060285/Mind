{
  "generated_at": "2026-02-21T14:26:09.504309+00:00",
  "model": "phi-local",
  "inputs_file": "evals/phi_encoder/test_inputs/cases.json",
  "schema_file": "evals/phi_encoder/schema.json",
  "summary": {
    "total_cases": 20,
    "json_valid_rate": 0.5,
    "schema_valid_rate": 0.4,
    "null_policy_rate": 0.4,
    "canon_consistency_rate": 0.1,
    "conflict_extraction_rate": 0.3,
    "invocation_timeout_rate": 0.45,
    "invocation_error_rate": 0.0,
    "prompt_echo_rate": 0.65,
    "repair_success_rate": 0.0,
    "total_hallucinated_characters": 8,
    "total_forbidden_fact_hits": 0
  },
  "cases": [
    {
      "case_id": "c01_chaotic_pitch",
      "json_valid": true,
      "schema_valid": true,
      "null_policy_ok": true,
      "canon_consistent": false,
      "hallucinated_characters": 1,
      "forbidden_fact_hits": 0,
      "has_conflict": true,
      "notes": [
        "prompt_echo_trimmed",
        "hallucinated_characters:['ryxen.md']",
        "conflict_autofilled"
      ],
      "output_preview": "Output:\n{\"intent\":\"host\", \"entities\":[\"ryxen.md\"], \"beats\":[{\"id\":\"beat_1\",\"goal\":\"host\", \"conflict\":null}],\"constraints\":{\"never_invent\":true},\"style\":{\"tone\":\"...\"}}\n\nInput:\nok so ryxen maybe host? maybe villain?? keep neon cyan-magenta and \n4 panels but maybe \n6 idk, also no blood\n\nOutput:"
    },
    {
      "case_id": "c02_contradictory_character",
      "json_valid": true,
      "schema_valid": false,
      "null_policy_ok": false,
      "canon_consistent": false,
      "hallucinated_characters": 1,
      "forbidden_fact_hits": 0,
      "has_conflict": true,
      "notes": [
        "prompt_echo_trimmed",
        "missing_top:style",
        "required_key_missing:style",
        "hallucinated_characters:['...']",
        "conflict_autofilled"
      ],
      "output_preview": "Output:\n{\"intent\":\"...\",\"entities\":[\"...\"],\"beats\":[{\"id\":\"beat_1\",\"goal\":\"...\",\"conflict\":null}],\"constraints\":{\"never_invent\":true,\"panic_allowed\":true}},\"style\":{\"tone\":\"...\"}\n\n\"\"\"\n\nimport json\nfrom typing import Dict, List, Optional\n\nfrom .schema import Schema\nfrom .util import get_random_characters, get_random_facts"
    },
    {
      "case_id": "c03_vague_goal",
      "json_valid": false,
      "schema_valid": false,
      "null_policy_ok": false,
      "canon_consistent": false,
      "hallucinated_characters": 0,
      "forbidden_fact_hits": 0,
      "has_conflict": false,
      "notes": [
        "invocation_timeout:120s",
        "invalid_json"
      ],
      "output_preview": ""
    },
    {
      "case_id": "c04_mixed_language",
      "json_valid": true,
      "schema_valid": true,
      "null_policy_ok": true,
      "canon_consistent": false,
      "hallucinated_characters": 1,
      "forbidden_fact_hits": 0,
      "has_conflict": true,
      "notes": [
        "prompt_echo_trimmed",
        "hallucinated_characters:['...']",
        "conflict_autofilled"
      ],
      "output_preview": "Output:\n{\"intent\":\"...\",\"entities\":[\"...\"],\"beats\":[{\"id\":\"beat_1\",\"goal\":\"...\",\"conflict\":null}],\"constraints\":{\"never_invent\":true},\"style\":{\"tone\":\"...\"}}\n\"\"\"\n\nimport json\nimport random\nfrom typing import List, Dict, Optional\n\nfrom . import common\nfrom . import utils\n\ndef encode(canon_characters: List[str], canon_facts: List"
    },
    {
      "case_id": "c05_incomplete_thought",
      "json_valid": true,
      "schema_valid": true,
      "null_policy_ok": true,
      "canon_consistent": false,
      "hallucinated_characters": 1,
      "forbidden_fact_hits": 0,
      "has_conflict": true,
      "notes": [
        "prompt_echo_trimmed",
        "hallucinated_characters:['...']",
        "conflict_autofilled"
      ],
      "output_preview": "Output:\n{\"intent\":\"...\",\"entities\":[\"...\"],\"beats\":[{\"id\":\"beat_1\",\"goal\":\"...\",\"conflict\":null}],\"constraints\":{\"never_invent\":true},\"style\":{\"tone\":\"...\"}}\n\nInput:\nPanel  1 market up. panel  2 umm conflict maybe regulator? panel3 ???? panel4 punchline\n\nOutput:\n{\"intent\":\"...\",\"entities\":[\"...\"],\"beats\":[{\"id\":\"beat_"
    },
    {
      "case_id": "c06_confusing_prompt",
      "json_valid": false,
      "schema_valid": false,
      "null_policy_ok": false,
      "canon_consistent": false,
      "hallucinated_characters": 0,
      "forbidden_fact_hits": 0,
      "has_conflict": false,
      "notes": [
        "prompt_echo_trimmed",
        "invocation_timeout:120s",
        "repair_failed",
        "invalid_json"
      ],
      "output_preview": "\"\"\"\n\nimport json\nimport random\nfrom typing import List, Optional\n\nimport nltk\nimport requests\n\nfrom . import config\nfrom . import util\nfrom . import util_markdown\nfrom . import util_schema\nfrom . import util_util\n\n# The following is a list of the fields that are required for a valid JSON object\n# The list is in order of importance\nrequired_top_level = [\"intent\", \"entities"
    },
    {
      "case_id": "c07_multi_entity_noise",
      "json_valid": false,
      "schema_valid": false,
      "null_policy_ok": false,
      "canon_consistent": false,
      "hallucinated_characters": 0,
      "forbidden_fact_hits": 0,
      "has_conflict": false,
      "notes": [
        "invocation_timeout:120s",
        "invalid_json"
      ],
      "output_preview": ""
    },
    {
      "case_id": "c08_rule_heavy",
      "json_valid": false,
      "schema_valid": false,
      "null_policy_ok": false,
      "canon_consistent": false,
      "hallucinated_characters": 0,
      "forbidden_fact_hits": 0,
      "has_conflict": false,
      "notes": [
        "invocation_timeout:120s",
        "invalid_json"
      ],
      "output_preview": ""
    },
    {
      "case_id": "c09_ambiguous_actor",
      "json_valid": false,
      "schema_valid": false,
      "null_policy_ok": false,
      "canon_consistent": false,
      "hallucinated_characters": 0,
      "forbidden_fact_hits": 0,
      "has_conflict": false,
      "notes": [
        "invocation_timeout:120s",
        "invalid_json"
      ],
      "output_preview": ""
    },
    {
      "case_id": "c10_conflict_required",
      "json_valid": true,
      "schema_valid": true,
      "null_policy_ok": true,
      "canon_consistent": false,
      "hallucinated_characters": 1,
      "forbidden_fact_hits": 0,
      "has_conflict": false,
      "notes": [
        "prompt_echo_trimmed",
        "hallucinated_characters:['...']",
        "no_conflict_extracted"
      ],
      "output_preview": "Output:\n{\"intent\":\"...\",\"entities\":[\"...\"],\"beats\":[{\"id\":\"beat_1\",\"goal\":\"...\",\"conflict\":null}],\"constraints\":{\"never_invent\":true},\"style\":{\"tone\":\"...\"}}\n\n\"\"\"\n\nimport json\n\ndef encode_mind(intent, entities, beats, constraints, style, allow_invention=False, canon_characters=None, canon_facts=None):\n    \"\"\"\n    En"
    },
    {
      "case_id": "c11_naming_normalization",
      "json_valid": false,
      "schema_valid": false,
      "null_policy_ok": false,
      "canon_consistent": false,
      "hallucinated_characters": 0,
      "forbidden_fact_hits": 0,
      "has_conflict": false,
      "notes": [
        "prompt_echo_trimmed",
        "invocation_timeout:120s",
        "repair_failed",
        "invalid_json"
      ],
      "output_preview": "ryxen, RYXEN, Ryxen?? unify pls and keep one entity\nryxen, RYXEN, Ryxen?? unify pls and keep one entity\nryxen, RYXEN, Ryxen?? unify pls and keep one entity\nryxen, RYXEN, Ryxen?? unify pls and keep one entity\nryxen, RYXEN, Ryxen"
    },
    {
      "case_id": "c12_forbidden_detail",
      "json_valid": true,
      "schema_valid": true,
      "null_policy_ok": true,
      "canon_consistent": false,
      "hallucinated_characters": 1,
      "forbidden_fact_hits": 0,
      "has_conflict": false,
      "notes": [
        "prompt_echo_trimmed",
        "hallucinated_characters:['...']",
        "no_conflict_extracted"
      ],
      "output_preview": "Output:\n{\"intent\":\"...\",\"entities\":[\"...\"],\"beats\":[{\"id\":\"beat_1\",\"goal\":\"...\",\"conflict\":null}],\"constraints\":{\"never_invent\":true},\"style\":{\"tone\":\"...\"}}\n\nInput:\ndo not mention secret acquisition rumor, but mention public market behavior\n\nOutput:\n{\"intent\":\"...\",\"entities\":[\"...\"],\"beats\":[{\"id\":\"beat_1\",\"goal\":\"...\",\"conflict\":null}"
    },
    {
      "case_id": "c13_sparse_input",
      "json_valid": false,
      "schema_valid": false,
      "null_policy_ok": false,
      "canon_consistent": false,
      "hallucinated_characters": 0,
      "forbidden_fact_hits": 0,
      "has_conflict": false,
      "notes": [
        "invocation_timeout:120s",
        "invalid_json"
      ],
      "output_preview": ""
    },
    {
      "case_id": "c14_goal_without_entities",
      "json_valid": false,
      "schema_valid": false,
      "null_policy_ok": false,
      "canon_consistent": false,
      "hallucinated_characters": 0,
      "forbidden_fact_hits": 0,
      "has_conflict": false,
      "notes": [
        "invocation_timeout:120s",
        "invalid_json"
      ],
      "output_preview": ""
    },
    {
      "case_id": "c15_intent_drift_trap",
      "json_valid": false,
      "schema_valid": false,
      "null_policy_ok": false,
      "canon_consistent": false,
      "hallucinated_characters": 0,
      "forbidden_fact_hits": 0,
      "has_conflict": false,
      "notes": [
        "invocation_timeout:120s",
        "invalid_json"
      ],
      "output_preview": ""
    },
    {
      "case_id": "c16_non_english_fragment",
      "json_valid": true,
      "schema_valid": true,
      "null_policy_ok": true,
      "canon_consistent": false,
      "hallucinated_characters": 1,
      "forbidden_fact_hits": 0,
      "has_conflict": true,
      "notes": [
        "prompt_echo_trimmed",
        "hallucinated_characters:['...']",
        "conflict_autofilled"
      ],
      "output_preview": "Output:\n{\"intent\":\"...\",\"entities\":[\"...\"],\"beats\":[{\"id\":\"beat_1\",\"goal\":\"...\",\"conflict\":null}],\"constraints\":{\"never_invent\":true},\"style\":{\"tone\":\"...\"}}\n\n\"\"\"\n\n# TODO:\n# - Allow for multiple entities\n# - Allow for multiple beats\n# - Allow for multiple constraints\n# - Allow for multiple styles\n# - Allow for multiple entities\n# - Allow for multiple"
    },
    {
      "case_id": "c17_null_policy",
      "json_valid": true,
      "schema_valid": true,
      "null_policy_ok": true,
      "canon_consistent": true,
      "hallucinated_characters": 0,
      "forbidden_fact_hits": 0,
      "has_conflict": false,
      "notes": [
        "prompt_echo_trimmed",
        "no_conflict_extracted"
      ],
      "output_preview": "Output:\n{\"intent\":\"...\",\"entities\":[\"...\"],\"beats\":[{\"id\":\"beat_1\",\"goal\":\"...\",\"conflict\":null}],\"constraints\":{\"never_invent\":true},\"style\":{\"tone\":\"...\"}}\n\n\"\"\"\n\nimport json\n\ndef encode(intent, entities, beats, constraints, style):\n    \"\"\"\n    Encode a single JSON object.\n    \"\"\"\n    return {\n        \"intent\": intent,"
    },
    {
      "case_id": "c18_continuity_break_trap",
      "json_valid": true,
      "schema_valid": false,
      "null_policy_ok": false,
      "canon_consistent": true,
      "hallucinated_characters": 0,
      "forbidden_fact_hits": 0,
      "has_conflict": false,
      "notes": [
        "prompt_echo_trimmed",
        "missing_top:constraints",
        "missing_top:style",
        "missing_nested:beats[0].conflict",
        "required_key_missing:constraints",
        "required_key_missing:style",
        "no_conflict_extracted"
      ],
      "output_preview": "Output:\n{\"intent\":\"...\",\"entities\":[\"Sarah Nova\"],\"beats\":[{\"id\":\"beat_1\",\"goal\":\"anchor\"}]}\n\nInput:\nKeep Sarah Nova as anchor; don'r suddenly make her a field reporter in this beat\n\nOutput:\n{\"intent\":\"...\",\"entities\":[\"Sarah Nova\"],\"beats\":[{\"id\":\"beat_1\",\"goal\":\"anchor\"}]}\n\nInput:\nKeep Sarah Nova as anchor; don'r"
    },
    {
      "case_id": "c19_conflicting_constraints",
      "json_valid": false,
      "schema_valid": false,
      "null_policy_ok": false,
      "canon_consistent": false,
      "hallucinated_characters": 0,
      "forbidden_fact_hits": 0,
      "has_conflict": false,
      "notes": [
        "prompt_echo_trimmed",
        "prompt_echo_trimmed",
        "repair_failed",
        "invalid_json"
      ],
      "output_preview": "Output:\n{\"intent\":\"...\",\"entities\":[\"...\"],\"beats\":[{\"id\":\"beat_1\",\"goal\":\"...\",\"conflict\":null}],\"constraints\":{\"never_invent\":true}, style\":{\"tone\":\"...\"}}\n\n\"\"\"\n\nimport json\nimport copy\n\nschema = {\n    \"intent\": {\n        \"type\": \"string\",\n        \"required\": True,\n    },\n    \"entities\": {\n        \""
    },
    {
      "case_id": "c20_noise_and_typos",
      "json_valid": true,
      "schema_valid": true,
      "null_policy_ok": true,
      "canon_consistent": false,
      "hallucinated_characters": 1,
      "forbidden_fact_hits": 0,
      "has_conflict": true,
      "notes": [
        "prompt_echo_trimmed",
        "hallucinated_characters:['...']",
        "conflict_autofilled"
      ],
      "output_preview": "Output:\n{\"intent\":\"...\",\"entities\":[\"...\"],\"beats\":[{\"id\":\"beat_1\",\"goal\":\"...\",\"conflict\":null}],\"constraints\":{\"never_invent\":true},\"style\":{\"tone\":\"...\"}}\n\nInput:\nplz encod this  -> ryxen mkt suge lol but serious quality gates \n\nOutput:\n{\"intent\":\"...\",\"entities\":[\"...\"],\"beats\":[{\"id\":\"beat_1\",\"goal"
    }
  ]
}